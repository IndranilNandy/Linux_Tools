#!/bin/bash

# Insert entry of this tool in .allTools. This is to be used in the verification stage post setup.
grep -q "springstarter:" ../../../_verify/.allTools || echo "springstarter:springstarter" >>../../../_verify/.allTools

#Check if all prerequisites are installed, and install the missing ones
prereq --install ".prereq"

# Exit if still missing any prerequisite
[[ $(prereq --missing ".prereq") ]] && echo -e "${RED}One or more prerequisites are still missing. Exiting.${RESET}" && exit 0

# Check if it is already installed
[[ -n $(which springstarter) ]] && echo -e "\n${GREEN}[springstarter] Already installed. Exiting.${RESET}" && exit 0

echo -e "${YELLOW}[springstarter] Setup process started.${RESET}"

yes | sudo ln -i -s "$(pwd)"/springstarter.sh "$MYCOMMANDSREPO"/springstarter && echo -e "\nCreated symbolink link springstarter in $MYCOMMANDSREPO"

mycompl -W \"db postgresql container init up down config clean help --f --sqltemplate=templatestore --sqltemplate=localdir --sqltemplate= localdir templatestore env secrets dotenv load sync show merge encrypt --remote --global --local \" springstarter
myalias --gen sspgcontainer=springstarter db postgresql container
myalias --gen sspgcontainerdefault=springstarter db postgresql container init
myalias --gen ssdotenv=springstarter env secrets dotenv
myalias --gen ssdotenvgen=springstarter env secrets dotenv load

echo -e "${GREEN}[springstarter] Setup finished.${RESET}"
