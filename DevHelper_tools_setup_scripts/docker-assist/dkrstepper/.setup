#!/bin/bash

# Insert entry of this tool in .allTools. This is to be used in the verification stage post setup.
grep -q "dkrdebugger:" ../../../_verify/.allTools || echo "dkrdebugger:dkrdebugger" >>../../../_verify/.allTools

#Check if all prerequisites are installed, and install the missing ones
prereq --install ".prereq"

# Exit if still missing any prerequisite
[[ $(prereq --missing ".prereq") ]] && echo -e "${RED}One or more prerequisites are still missing. Exiting.${RESET}" && exit 0

# Check if it is already installed
[[ -n $(which dkrdebugger) ]] && echo -e "\n${GREEN}[dkrdebugger] Already installed. Exiting.${RESET}" && exit 0

echo -e "${YELLOW}[dkrdebugger] Setup process started.${RESET}"

yes | sudo ln -i -s "$(pwd)"/dkrdebugger.sh "$MYCOMMANDSREPO"/dkrdebugger && echo -e "\nCreated symbolink link dkrdebugger in $MYCOMMANDSREPO"
yes | sudo ln -i -s "$(pwd)"/dkrstepperconfig.sh "$MYCOMMANDSREPO"/dkrstepperconfig && echo -e "\nCreated symbolink link dkrstepperconfig in $MYCOMMANDSREPO"

myalias --gen dkrstepperconfig=. dkrstepperconfig

mycompl -W \"--basedir --dockerfile --context --startline --help --allruns --containers --images step clean\" dkrdebugger
mycompl -W \"--options --options-reset --options-reset=  --options-reset=build --options-reset=run --help\" dkrstepperconfig

echo -e "${GREEN}[dkrdebugger] Setup finished.${RESET}"
