#!/usr/bin/env bash

userhost="${1}"@"${2}"
passwd=
failure=0

fromPrompt() {
    while :; do
        # read -p "Enter user@hostname: " userhost
        read -p "Password for $userhost: " -s passwd
        echo -e

        sshpass -p $passwd ssh -o 'StrictHostKeyChecking no' -t "$userhost" "hostname" && break || ((failure++))

        [[ "$failure" -ge 3 ]] && userhost= && passwd= && break
        echo -e "Try#$failure"
    done
}

case "$psdsource" in
prompt)
    echo -e "credentials source: prompt"
    fromPrompt
    ;;
file)
    echo -e "credentials source: file"
    passwd=$(cat $(pwd)/config/.credconfig | grep -i "${2}:" | grep -i "${1}" | awk '{ print $3 }')
    ;;
"")
    echo -e "credentials source: default [prompt]"
    fromPrompt
    ;;
esac
