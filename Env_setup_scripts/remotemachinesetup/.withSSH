#!/bin/bash

# userhost="${1}"
# cred="${2}"

. ./lib/loadCred.sh

[[ -z "$cred" ]] && exit 1

read -p "Ensure that ~/MyTools/ doesn't exist in the remote machine. Do you want to proceed? [y] or [n] " ans
[[ "$(echo $ans | tr [:upper:] [:lower:])" == "n" ]] && exit 0

echo -e "Copying codebase to ""$userhost"
sshpass -p "$cred" scp -r ~/MyTools "$userhost":~ && echo "Codebase copied."

echo -e "Running setup script..."

read -p "type=? (min|default|dev|full) [default type: dev]" inst
read -p "log-target=? (term|file) [default log: term]" log
read -p "custom-setup=? (server-minimal [default custom-setup: server-minimal])" cust

inst || inst=dev
log || log=term
cust || cust=server-minimal

echo -e "./.setup --type=$inst --log-target=$log --custom-setup=$cust"
sshpass -p "$cred" ssh -t "$userhost" "cd ~/MyTools/Linux_Tools/; bash --login ./.setup --type=$inst --log-target=$log --custom-setup=$cust"

exit 0

